<mxfile host="app.diagrams.net">
  <diagram id="loganalyser-architecture" name="Log Analyser Architecture">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Log Analyser - System Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- Client Layer -->
        <mxCell id="client" value="Client Applications" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="100" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- API Gateway / Controller -->
        <mxCell id="controller" value="QueryController&#xa;/api/query&#xa;/api/health" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="200" width="200" height="80" as="geometry" />
        </mxCell>

        <!-- Service Layer -->
        <mxCell id="logAnalysisService" value="LogAnalysisService&#xa;(Orchestration)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="320" width="200" height="80" as="geometry" />
        </mxCell>

        <!-- Transaction Services -->
        <mxCell id="transactionRepo" value="TransactionRepository&#xa;(JPA)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="150" y="320" width="150" height="60" as="geometry" />
        </mxCell>

        <mxCell id="elasticsearchService" value="ElasticsearchService&#xa;(Log Search &amp; Pagination)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1050" y="320" width="200" height="80" as="geometry" />
        </mxCell>

        <mxCell id="openAIService" value="OpenAIService&#xa;(AI Analysis)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="600" y="440" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Data Layer -->
        <mxCell id="h2db" value="H2 Database&#xa;(In-Memory)&#xa;&#xa;Transactions Table&#xa;- transaction_id&#xa;- uuid&#xa;- service_id" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="150" y="500" width="150" height="120" as="geometry" />
        </mxCell>

        <mxCell id="elasticsearch" value="Elasticsearch&#xa;(Index: application-logs)&#xa;&#xa;LogDocument Fields:&#xa;- transaction_id&#xa;- uuid&#xa;- log_line&#xa;- timestamp&#xa;- log_level" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1050" y="500" width="200" height="140" as="geometry" />
        </mxCell>

        <mxCell id="logFile" value="Log File&#xa;(application.log)&#xa;&#xa;Source logs with&#xa;transaction IDs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="350" y="500" width="150" height="100" as="geometry" />
        </mxCell>

        <!-- External Services -->
        <mxCell id="openai" value="OpenAI API&#xa;(GPT-4)&#xa;&#xa;Log Analysis&#xa;&amp; Insights" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="700" width="200" height="80" as="geometry" />
        </mxCell>

        <!-- Indexing Service -->
        <mxCell id="logIndexingService" value="LogIndexingService&#xa;(Startup Indexing)&#xa;&#xa;Parses log file&#xa;Indexes to Elasticsearch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="350" y="640" width="150" height="100" as="geometry" />
        </mxCell>

        <!-- Connections -->
        <!-- Client to Controller -->
        <mxCell id="edge1" value="HTTP POST/GET" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666" edge="1" parent="1" source="client" target="controller">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Controller to LogAnalysisService -->
        <mxCell id="edge2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666" edge="1" parent="1" source="controller" target="logAnalysisService">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- LogAnalysisService to TransactionRepository -->
        <mxCell id="edge3" value="1. Lookup Transaction" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;endArrow=block;endFill=1" edge="1" parent="1" source="logAnalysisService" target="transactionRepo">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="550" y="360" />
              <mxPoint x="550" y="350" />
              <mxPoint x="225" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- TransactionRepository to H2 -->
        <mxCell id="edge4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#9673a6;endArrow=block;endFill=1" edge="1" parent="1" source="transactionRepo" target="h2db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- LogAnalysisService to ElasticsearchService -->
        <mxCell id="edge5" value="2. Search Logs&#xa;(Paginated)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;endArrow=block;endFill=1" edge="1" parent="1" source="logAnalysisService" target="elasticsearchService">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="850" y="360" />
              <mxPoint x="850" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ElasticsearchService to Elasticsearch -->
        <mxCell id="edge6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#b85450;endArrow=block;endFill=1" edge="1" parent="1" source="elasticsearchService" target="elasticsearch">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- LogAnalysisService to OpenAIService -->
        <mxCell id="edge7" value="3. Analyze Logs" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;endArrow=block;endFill=1" edge="1" parent="1" source="logAnalysisService" target="openAIService">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- OpenAIService to OpenAI -->
        <mxCell id="edge8" value="API Call" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#d79b00;endArrow=block;endFill=1" edge="1" parent="1" source="openAIService" target="openai">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- LogFile to LogIndexingService -->
        <mxCell id="edge9" value="Read &amp; Parse" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;endArrow=block;endFill=1" edge="1" parent="1" source="logFile" target="logIndexingService">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- LogIndexingService to Elasticsearch -->
        <mxCell id="edge10" value="Index Logs&#xa;(On Startup)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#b85450;endArrow=block;endFill=1" edge="1" parent="1" source="logIndexingService" target="elasticsearch">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="550" y="690" />
              <mxPoint x="550" y="570" />
              <mxPoint x="1150" y="570" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Flow Labels -->
        <mxCell id="flow1" value="Request: {transactionId, query}" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#0066CC" vertex="1" parent="1">
          <mxGeometry x="620" y="165" width="160" height="20" as="geometry" />
        </mxCell>

        <mxCell id="flow2" value="Response: Analysis Result" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#0066CC" vertex="1" parent="1">
          <mxGeometry x="580" y="770" width="240" height="20" as="geometry" />
        </mxCell>

        <!-- Liquibase -->
        <mxCell id="liquibase" value="Liquibase&#xa;(Schema Management)&#xa;&#xa;Creates tables&#xa;Inserts transaction data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="150" y="650" width="150" height="90" as="geometry" />
        </mxCell>

        <mxCell id="edge11" value="Schema &amp; Data" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#9673a6;endArrow=block;endFill=1;dashed=1" edge="1" parent="1" source="liquibase" target="h2db">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="225" y="620" as="sourcePoint" />
            <mxPoint x="225" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend" value="Legend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="100" width="120" height="200" as="geometry" />
        </mxCell>

        <mxCell id="legend1" value="Client/API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9" vertex="1" parent="1">
          <mxGeometry x="60" y="130" width="100" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend2" value="Service Layer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9" vertex="1" parent="1">
          <mxGeometry x="60" y="160" width="100" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend3" value="Data Storage" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9" vertex="1" parent="1">
          <mxGeometry x="60" y="195" width="100" height="40" as="geometry" />
        </mxCell>

        <mxCell id="legend4" value="External API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9" vertex="1" parent="1">
          <mxGeometry x="60" y="245" width="100" height="25" as="geometry" />
        </mxCell>

        <!-- Configuration -->
        <mxCell id="config" value="Configuration&#xa;&#xa;application.properties&#xa;- Elasticsearch connection&#xa;- OpenAI API key&#xa;- Log file path&#xa;- Database settings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="50" y="320" width="120" height="120" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

